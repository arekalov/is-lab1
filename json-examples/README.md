# –ü—Ä–∏–º–µ—Ä—ã JSON –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞

## üéØ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–ø–æ—Ä—Ç–∞

API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–µ–¥–∏–Ω—É—é —Ä—É—á–∫—É** –¥–ª—è CREATE/UPDATE/DELETE –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤.

### –≠–Ω–¥–ø–æ–∏–Ω—Ç
```
POST /api/import
```

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

```json
[
  {
    "type": "FLAT | HOUSE | COORDINATES",
    "operation": "CREATE | UPDATE | DELETE",  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∞–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
    "data": { /* –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞ */ }
  }
]
```

---

## üìù –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–ü–æ–ª–µ `operation` **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ**. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **CREATE** - –µ—Å–ª–∏ –≤ `data` –Ω–µ—Ç –ø–æ–ª—è `id` –∏–ª–∏ `id` = null
- **UPDATE** - –µ—Å–ª–∏ –≤ `data` –µ—Å—Ç—å –ø–æ–ª–µ `id`
- **DELETE** - –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å

---

## üîß –§–æ—Ä–º–∞—Ç –æ–±—ä–µ–∫—Ç–æ–≤

### FLAT (–ö–≤–∞—Ä—Ç–∏—Ä–∞)

**CREATE:**
```json
{
  "type": "FLAT",
  "operation": "CREATE",  // –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å
  "data": {
    "name": "string (required)",
    "floor": number (required, > 0),
    "area": number (required, > 0),
    "price": number (required, 1-581208244),
    "balcony": boolean (optional),
    "timeToMetroOnFoot": number (required, > 0),
    "numberOfRooms": number (required, 1-13),
    "livingSpace": number (required, > 0),
    "furnish": "DESIGNER | FINE | BAD | LITTLE",
    "view": "STREET | YARD | BAD | GOOD | TERRIBLE",
    "coordinates": {  // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      "x": number,
      "y": number (<= 661)
    },
    "house": {  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      "name": "string",
      "year": number (> 0),
      "numberOfFlatsOnFloor": number (> 0)
    }
  }
}
```

**UPDATE:**
```json
{
  "type": "FLAT",
  "data": {  // operation –Ω–µ –Ω—É–∂–µ–Ω, –µ—Å—Ç—å id ‚Üí UPDATE
    "id": 1,
    "name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
    "price": 6000000,
    // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã, –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è
  }
}
```

**DELETE:**
```json
{
  "type": "FLAT",
  "operation": "DELETE",  // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å
  "data": {
    "id": 1
  }
}
```

---

### HOUSE (–î–æ–º)

**CREATE:**
```json
{
  "type": "HOUSE",
  "data": {
    "name": "string (required)",
    "year": number (required, > 0),
    "numberOfFlatsOnFloor": number (required, > 0)
  }
}
```

**UPDATE:**
```json
{
  "type": "HOUSE",
  "data": {
    "id": 1,
    "name": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
    "year": 2024,
    "numberOfFlatsOnFloor": 6
  }
}
```

**DELETE:**
```json
{
  "type": "HOUSE",
  "operation": "DELETE",
  "data": {
    "id": 1
  }
}
```

---

### COORDINATES (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

**CREATE:**
```json
{
  "type": "COORDINATES",
  "data": {
    "x": number (required),
    "y": number (required, <= 661)
  }
}
```

**UPDATE:**
```json
{
  "type": "COORDINATES",
  "data": {
    "id": 1,
    "x": 150.5,
    "y": 300
  }
}
```

**DELETE:** ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏)

---

## üì¶ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. import-create-mixed.json
**–°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä —Å –¥–æ–º–∞–º–∏ + –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–º**

```bash
curl -X POST http://localhost:8080/is-lab1/api/import \
  -H "Content-Type: application/json" \
  -d @json-examples/import-create-mixed.json
```

**–°–æ–∑–¥–∞—Å—Ç—Å—è:**
- 2 –∫–≤–∞—Ä—Ç–∏—Ä—ã (—Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ –¥–æ–º–∞–º–∏)
- 4 –¥–æ–º–∞ (2 –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö + 1 –æ—Ç–¥–µ–ª—å–Ω—ã–π)
- 2 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

---

### 2. import-update.json
**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤**

```bash
curl -X POST http://localhost:8080/is-lab1/api/import \
  -H "Content-Type: application/json" \
  -d @json-examples/import-update.json
```

**–û–±–Ω–æ–≤–∏—Ç—Å—è:**
- –ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å id=1
- –î–æ–º —Å id=1

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –û–±—ä–µ–∫—Ç—ã —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ id –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ë–î!

---

### 3. import-delete.json
**–£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤**

```bash
curl -X POST http://localhost:8080/is-lab1/api/import \
  -H "Content-Type: application/json" \
  -d @json-examples/import-delete.json
```

**–£–¥–∞–ª–∏—Ç—Å—è:**
- –ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å id=1
- –î–æ–º —Å id=2

---

### 4. import-all-operations.json
**–°–º–µ—Å—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

```bash
curl -X POST http://localhost:8080/is-lab1/api/import \
  -H "Content-Type: application/json" \
  -d @json-examples/import-all-operations.json
```

**–í—ã–ø–æ–ª–Ω–∏—Ç—Å—è:**
1. CREATE –¥–æ–º–∞
2. CREATE –∫–≤–∞—Ä—Ç–∏—Ä—ã
3. UPDATE –∫–≤–∞—Ä—Ç–∏—Ä—ã (id=2)
4. DELETE –∫–≤–∞—Ä—Ç–∏—Ä—ã (id=5)
5. UPDATE –¥–æ–º–∞ (id=3)

---

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (201 Created)

```json
{
  "id": 1,
  "operationTime": "2025-12-07T18:30:00",
  "objectsCount": 5,
  "changesDescription": "[{\"type\":\"FLAT\",\"operation\":\"CREATE\",\"id\":1,\"name\":\"–ö–≤–∞—Ä—Ç–∏—Ä–∞ 101\"},{\"type\":\"HOUSE\",\"operation\":\"UPDATE\",\"id\":2,\"name\":\"–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–æ–º\"}...]"
}
```

### –ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:
- `id` - ID –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏
- `operationTime` - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `objectsCount` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π (—Å—É–º–º–∞ –≤—Å–µ—Ö CREATE/UPDATE/DELETE)
- `changesDescription` - JSON –º–∞—Å—Å–∏–≤ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
  ```json
  [
    {
      "type": "FLAT",
      "operation": "CREATE",
      "id": 1,
      "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ 101"
    },
    {
      "type": "COORDINATES",
      "operation": "CREATE",
      "id": 5,
      "name": "(100.50, 200)"
    }
  ]
  ```

---

## ‚ùå –û—à–∏–±–∫–∏

### 400 Bad Request - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```json
{
  "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: –ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n- price: –¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"
}
```

### 400 Bad Request - –û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
```json
{
  "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: –ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å id=999 –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
}
```

### 500 Internal Server Error
```json
{
  "message": "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ..."
}
```

---

## ‚ö° –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å

### üîí –í—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ!

–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ **–û–î–ù–û–ô —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:
- –ï—Å–ª–∏ **–ª—é–±–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è** –Ω–µ –ø—Ä–æ—à–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é ‚Üí **–í–°–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è**
- –ï—Å–ª–∏ **–ª—é–±–∞—è –æ—à–∏–±–∫–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, UPDATE –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞) ‚Üí **–í–°–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è**
- –í –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å–ø–µ—à–Ω—ã–µ** –∏–º–ø–æ—Ä—Ç—ã

**–ü—Ä–∏–º–µ—Ä:**
```json
[
  {"type": "FLAT", "data": {...}},  // ‚úÖ OK
  {"type": "HOUSE", "data": {...}}, // ‚úÖ OK
  {"type": "FLAT", "data": {"price": -100}} // ‚ùå –û–®–ò–ë–ö–ê –≤–∞–ª–∏–¥–∞—Ü–∏–∏
]
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: **–ù–ò–ß–ï–ì–û –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è**, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏—Ç—Å—è!

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–∞

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏
```bash
GET /api/import/history?page=0&size=10
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–ø–∏—Å–µ–π
```bash
GET /api/import/history/latest?limit=5
```

### –û—Ç–≤–µ—Ç:
```json
[
  {
    "id": 3,
    "operationTime": "2025-12-07T18:30:00",
    "objectsCount": 8,
    "changesDescription": "[{\"type\":\"FLAT\",\"operation\":\"CREATE\",\"id\":10,\"name\":\"–ö–≤–∞—Ä—Ç–∏—Ä–∞\"}...]"
  }
]
```

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–ø–æ—Ä—Ç–∞ –∫–≤–∞—Ä—Ç–∏—Ä
–î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```bash
POST /api/import/flats
```

**–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–º–∞—Å—Å–∏–≤ –∫–≤–∞—Ä—Ç–∏—Ä):**
```json
[
  {
    "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ 101",
    "floor": 1,
    "area": 50,
    ...
    "coordinates": {...},
    "house": {...}
  }
]
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /api/import`.

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–∞–∂–µ–Ω:**
   - –°–Ω–∞—á–∞–ª–∞ CREATE –¥–æ–º–æ–≤, –ø–æ—Ç–æ–º –∫–≤–∞—Ä—Ç–∏—Ä —Å —ç—Ç–∏–º–∏ –¥–æ–º–∞–º–∏
   - DELETE –∫–≤–∞—Ä—Ç–∏—Ä –ø–µ—Ä–µ–¥ DELETE –¥–æ–º–æ–≤

2. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:**
   - –ü—Ä–∏ CREATE –∫–≤–∞—Ä—Ç–∏—Ä—ã –º–æ–∂–Ω–æ –≤–ª–æ–∂–∏—Ç—å `coordinates` –∏ `house` - –æ–Ω–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü—Ä–∏ UPDATE –∫–≤–∞—Ä—Ç–∏—Ä—ã –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—ë –ø–æ–ª—è, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å–≤—è–∑–∏

3. **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ü—Ä–∏ UPDATE —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—è–µ–º—ã–µ –ø–æ–ª—è
   - –ù–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

4. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –ü—Ä–∏ CREATE/UPDATE/DELETE –∫–≤–∞—Ä—Ç–∏—Ä –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ `/ws/updates` –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

# Информационные системы: лабораторная работа №1

## Описание задания

Реализовать информационную систему, которая позволяет взаимодействовать с объектами класса Flat, описание которого приведено ниже:

```java
public class Flat {
    private Long id; //Поле не может быть null, Значение поля должно быть больше 0, Значение этого поля должно быть уникальным, Значение этого поля должно генерироваться автоматически
    private String name; //Поле не может быть null, Строка не может быть пустой
    private Coordinates coordinates; //Поле не может быть null
    private java.time.ZonedDateTime creationDate; //Поле не может быть null, Значение этого поля должно генерироваться автоматически
    private long area; //Значение поля должно быть больше 0
    private long price; //Максимальное значение поля: 581208244, Значение поля должно быть больше 0
    private Boolean balcony; //Поле может быть null
    private long timeToMetroOnFoot; //Значение поля должно быть больше 0
    private Integer numberOfRooms; //Максимальное значение поля: 13, Значение поля должно быть больше 0
    private long livingSpace; //Значение поля должно быть больше 0
    private Furnish furnish; //Поле не может быть null
    private View view; //Поле не может быть null
    private House house; //Поле может быть null
}

public class Coordinates {
    private Integer x; //Поле не может быть null
    private int y;
}

public class House {
    private String name; //Поле может быть null
    private int year; //Значение поля должно быть больше 0
    private int numberOfFlatsOnFloor; //Значение поля должно быть больше 0
}

public enum Furnish {
    DESIGNER,
    NONE,
    FINE,
    BAD,
    LITTLE;
}

public enum View {
    STREET,
    YARD,
    GOOD;
}
```

## Требования к системе

Разработанная система должна удовлетворять следующим требованиям:

1. Основное назначение информационной системы - управление объектами, созданными на основе заданного в варианте класса.

2. Необходимо, чтобы с помощью системы можно было выполнить следующие операции с объектами: создание нового объекта, получение информации об объекте по ИД, обновление объекта (модификация его атрибутов), удаление объекта. Операции должны осуществляться в отдельных окнах (интерфейсах) приложения. При получении информации об объекте класса должна также выводиться информация о связанных с ним объектах.

3. При создании объекта класса необходимо дать пользователю возможность связать новый объект с объектами вспомогательных классов, которые могут быть связаны с созданным объектом и уже есть в системе.

4. Выполнение операций по управлению объектами должно осуществляться на серверной части (не на клиенте), изменения должны синхронизироваться с базой данных.

5. На главном экране системы должен выводиться список текущих объетов в виде таблицы (каждый атрибут объекта - отдельная колонка в таблице). При отображении таблицы должна использоваться пагинация (если все объекты не помещаются на одном экране).

6. Нужно обеспечить возможность фильтровать/сортировать строки таблицы, которые показывают объекты (по значениям любой из строковых колонок). Фильтрация элементов должна производиться по неполному совпадению.

7. Переход к обновлению (модификации) объекта должен быть возможен из таблицы с общим списком объектов и из области с визуализацией объекта (при ее реализации).

8. При добавлении/удалении/изменении объекта, он должен автоматически появиться/исчезнуть/измениться в интерфейсах у других пользователей, авторизованных в системе.

9. Если при удалении объекта с ним связан другой объект, связанные объекты должны удаляться.

10. Пользователи должны иметь возможность просмотра всех объектов. Для модификации объекта должно открываться отдельное диалоговое окно. При вводе некорректных значений в поля объекта должны появляться информативные сообщения о соответствующих ошибках.

## Специальные операции

В системе должен быть реализован отдельный пользовательский интерфейс для выполнения специальных операций над объектами:

1. Вернуть количество объектов, значение поля numberOfRooms которых больше заданного.
2. Вернуть массив объектов, значение поля name которых содержит заданную подстроку.
3. Вернуть массив объектов, значение поля livingSpace которых меньше заданного.
4. Найти самую дешёвую квартиру с балконом.
5. Вернуть список всех квартир, отсортированный по времени, которое требуется, чтобы добраться от них до метро пешком в порядке возрастания

Представленные операции должны быть реализованы в рамках компонентов бизнес-логики приложения без прямого использования функций и процедур БД.

## Особенности хранения объектов

Особенности хранения объектов, которые должны быть реализованы в системе:

1. Организовать хранение данных об объектах в реляционной СУБД (PostgreSQL). Каждый объект, с которым работает ИС, должен быть сохранен в базе данных.
2. Все требования к полям класса (указанные в виде комментариев к описанию классов) должны быть выполнены на уровне ORM и БД.
3. Для генерации поля id использовать средства базы данных.
4. Для подключения к БД на кафедральном сервере использовать хост pg, имя базы данных - studs, имя пользователя/пароль совпадают с таковыми для подключения к серверу.

## Особенности взаимодействия с пользователем

При создании системы нужно учитывать следующие особенности организации взаимодействия с пользователем:

1. Система должна реагировать на некорректный пользовательский ввод, ограничивая ввод недопустимых значений и информируя пользователей о причине ошибки.
2. Переходы между различными логически обособленными частями системы должны осуществляться с помощью меню.
3. При добавлении/удалении/изменении объекта, он должен автоматически появиться/исчезнуть/измениться на области у всех других клиентов.

## Технические требования

При разработке ИС должны учитываться следующие требования:

1. В качестве основы для реализации ИС необходимо использовать Java EE, Managed Beans.
2. Для создания уровня хранения необходимо использовать EclipseLink.
3. Разные уровни приложения должны быть отделены друг от друга, разные логические части ИС должны находиться в отдельных компонентах.

## Примечание

Это задание к лабораторной работе, но реализация будет выполнена как сервер без JSP, только REST endpoints, фронтенд будет отдельный на React.

## API Endpoints

### Базовый URL
```
http://se.ifmo.ru:28602/is-lab1/api
```

### Health Check

#### GET /health
Проверка состояния сервера.

**Ответ:**
```json
{
  "status": "UP",
  "timestamp": "2024-01-01T12:00:00Z",
  "application": "Flats Management System",
  "version": "1.0.0"
}
```

### Управление домами (Houses)

#### GET /houses
Получить список всех домов.

**Ответ:** `200 OK`
```json
[
  {
    "id": 1,
    "name": "Дом на Невском",
    "year": 2020,
    "numberOfFlatsOnFloor": 4
  }
]
```

#### GET /houses/{id}
Получить дом по ID.

**Параметры:**
- `id` (path) - ID дома

**Ответы:**
- `200 OK` - дом найден
- `404 Not Found` - дом не найден

#### POST /houses
Создать новый дом.

**Тело запроса:**
```json
{
  "name": "Новый дом",
  "year": 2023,
  "numberOfFlatsOnFloor": 6
}
```

**Ответы:**
- `201 Created` - дом создан
- `400 Bad Request` - некорректные данные

#### PUT /houses/{id}
Обновить дом.

**Параметры:**
- `id` (path) - ID дома

**Тело запроса:**
```json
{
  "name": "Обновленное название",
  "year": 2024,
  "numberOfFlatsOnFloor": 8
}
```

**Ответы:**
- `200 OK` - дом обновлен
- `404 Not Found` - дом не найден
- `400 Bad Request` - некорректные данные

#### DELETE /houses/{id}
Удалить дом.

**Параметры:**
- `id` (path) - ID дома

**Ответы:**
- `204 No Content` - дом удален
- `404 Not Found` - дом не найден

#### GET /houses/search
Поиск домов по названию.

**Параметры:**
- `name` (query) - подстрока для поиска в названии

**Пример:** `/houses/search?name=Невский`

### Управление квартирами (Flats)

#### GET /flats
Получить список квартир с пагинацией и фильтрацией.

**Параметры запроса:**
- `page` (query, optional) - номер страницы (по умолчанию: 0)
- `size` (query, optional) - размер страницы (по умолчанию: 20)
- `sortBy` (query, optional) - поле для сортировки (по умолчанию: id)
- `name` (query, optional) - фильтр по названию квартиры
- `minPrice` (query, optional) - минимальная цена
- `maxPrice` (query, optional) - максимальная цена
- `hasBalcony` (query, optional) - наличие балкона (true/false)
- `minRooms` (query, optional) - минимальное количество комнат
- `maxRooms` (query, optional) - максимальное количество комнат

**Пример:** `/flats?page=0&size=10&minPrice=1000000&hasBalcony=true`

**Ответ:** `200 OK`
```json
{
  "content": [
    {
      "id": 1,
      "name": "Уютная квартира",
      "coordinates": {
        "x": 100,
        "y": 200
      },
      "creationDate": "2024-01-01T12:00:00Z",
      "area": 50,
      "price": 5000000,
      "balcony": true,
      "timeToMetroOnFoot": 10,
      "numberOfRooms": 2,
      "livingSpace": 35,
      "furnish": "FINE",
      "view": "STREET",
      "house": {
        "id": 1,
        "name": "Дом на Невском",
        "year": 2020,
        "numberOfFlatsOnFloor": 4
      }
    }
  ],
  "totalElements": 1,
  "totalPages": 1,
  "currentPage": 0,
  "pageSize": 20
}
```

#### GET /flats/{id}
Получить квартиру по ID.

**Параметры:**
- `id` (path) - ID квартиры

**Ответы:**
- `200 OK` - квартира найдена
- `404 Not Found` - квартира не найдена

#### POST /flats
Создать новую квартиру.

**Тело запроса:**
```json
{
  "name": "Новая квартира",
  "coordinates": {
    "x": 150,
    "y": 250
  },
  "area": 60,
  "price": 6000000,
  "balcony": true,
  "timeToMetroOnFoot": 15,
  "numberOfRooms": 3,
  "livingSpace": 40,
  "furnish": "DESIGNER",
  "view": "GOOD",
  "houseId": 1
}
```

**Ответы:**
- `201 Created` - квартира создана
- `400 Bad Request` - некорректные данные

#### PUT /flats/{id}
Обновить квартиру.

**Параметры:**
- `id` (path) - ID квартиры

**Тело запроса:** аналогично POST /flats

**Ответы:**
- `200 OK` - квартира обновлена
- `404 Not Found` - квартира не найдена
- `400 Bad Request` - некорректные данные

#### DELETE /flats/{id}
Удалить квартиру.

**Параметры:**
- `id` (path) - ID квартиры

**Ответы:**
- `204 No Content` - квартира удалена
- `404 Not Found` - квартира не найдена

### Специальные операции с квартирами

#### GET /flats/count-by-rooms
Подсчитать квартиры с количеством комнат больше заданного.

**Параметры:**
- `minRooms` (query, required) - минимальное количество комнат

**Пример:** `/flats/count-by-rooms?minRooms=2`

**Ответ:** `200 OK`
```json
5
```

#### GET /flats/search-by-name
Найти квартиры по названию (содержит подстроку).

**Параметры:**
- `name` (query, required) - подстрока для поиска

**Пример:** `/flats/search-by-name?name=уютная`

**Ответ:** `200 OK` - массив объектов FlatDTO

#### GET /flats/by-living-space
Найти квартиры с жилой площадью меньше заданной.

**Параметры:**
- `maxSpace` (query, required) - максимальная жилая площадь

**Пример:** `/flats/by-living-space?maxSpace=40`

**Ответ:** `200 OK` - массив объектов FlatDTO

#### GET /flats/cheapest-with-balcony
Найти самую дешевую квартиру с балконом.

**Ответы:**
- `200 OK` - объект FlatDTO
- `404 Not Found` - квартиры с балконом не найдены

#### GET /flats/sorted-by-metro-time
Получить все квартиры, отсортированные по времени до метро.

**Ответ:** `200 OK` - массив объектов FlatDTO, отсортированный по возрастанию времени до метро

### Модели данных

#### Enum Furnish
```
DESIGNER, NONE, FINE, BAD, LITTLE
```

#### Enum View
```
STREET, YARD, GOOD
```

### Коды ошибок

Все ошибки возвращаются в формате:
```json
{
  "message": "Описание ошибки"
}
```

- `400 Bad Request` - некорректные данные запроса
- `404 Not Found` - ресурс не найден
- `500 Internal Server Error` - внутренняя ошибка сервера
